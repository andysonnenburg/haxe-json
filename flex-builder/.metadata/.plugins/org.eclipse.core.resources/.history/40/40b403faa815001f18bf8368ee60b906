<?xml version="1.0" encoding="utf-8"?>
<WindowedApplication xmlns="http://www.adobe.com/2006/mxml" layout="absolute" creationComplete="profile()">
	<Script>
		<![CDATA[
			import flash.utils.getTimer;
			import com.rational.utils.CharStream;
			import com.adobe.serialization.json.JSONTokenizer;
			import com.rational.serialization.json.Lexer;
			import com.rational.serialization.json.JSON;
			
			private static const LENGTH:int = 100;
			private static const MAX:int = 100;
			
			private function profile():void {
				var
					o:SimpleObject,
					accumulated:int = 0,
					start:int, end:int,
					i:int, j:int,
					s:String;
				const array:Array = new Array(LENGTH);
				for (i = 0; i < LENGTH; i += 1) {
					o = new SimpleObject();
					o.booleanField = true;
					o.stringField = "hello, world!";
					o.numberField = 3.1415;
					array[i] = o;
				}
				s = JSON.encode(array);
				trace(s);
				for (i = 0; i < s.length; i += 1) {
					trace(i, s.charCodeAt(i));
				}
				for (i = 0; i < MAX; i += 1) {
					start = getTimer();
					const lexer:Lexer = new Lexer(new CharStream(s));
					for (j = 0; j < LENGTH; j += 1) {
						lexer.pop();
					}
					end = getTimer();
					accumulated += end - start;
				}
				accumulated = 0;
				haxeJsonResult.text = String(accumulated);
				for (i = 0; i < MAX; i += 1) {
					start = getTimer();
					const tokenizer:JSONTokenizer = new JSONTokenizer(s);
					for (j = 0; j < LENGTH; j += 1) {
						tokenizer.getNextToken();
					}
					end = getTimer();
					accumulated += end - start;
				}
				as3corelibResult.text = String(accumulated);		
			}
		]]>
	</Script>
	<VBox>
		<Label text="haxe-json"/>
		<Label id="haxeJsonResult"/>
		<Label text="as3corelib"/>
		<Label id="as3corelibResult"/>
	</VBox>
</WindowedApplication>
